FROM python:3.12-slim
WORKDIR /app
COPY . /app
RUN apt-get update && \
    apt-get install -y build-essential ffmpeg libsm6 libxext6 dos2unix jq && \
    apt-get clean && \
    rm -rf /var/lib/apt/lists/*
RUN pip install --no-cache-dir -r requirements.txt
RUN gcc --version
RUN dos2unix /app/run_main.sh
RUN chmod a+x /app/run_main.sh
RUN chmod a+x ./run_main.sh
ENV PYTHONPATH=/app/src
ENTRYPOINT ["/app/run_main.sh"]